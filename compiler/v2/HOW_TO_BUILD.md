## 依存パッケージ

### On Ubuntu

- g++-10
    - GCC 10 以上のバージョンであればビルド可
- binutils
    - opelac が出力したアセンブリコードのビルドに必要です

Ubuntu 20.04 (WSL2) で動作を確認しています。

### On M1 Mac

将来的に対応を目指していますが、V2 はまだ M1 Mac 移植を行っていません。

## opelac のビルド

    $ make

これで、ビルドしたマシン上で動作する opelac が生成されます。

デフォルトのコンパイラだとコンパイル出来ない可能性があります。
以下のように、C++20 以上に対応したコンパイラを CXX 変数で指定してください。

    $ make CXX=g++-10

## opelac のテスト

    $ make test

テストを起動した環境に応じて自動的にアーキテクチャ（x86-64、AArch64）が選択されます。

## サンプルアプリの実行

example ディレクトリ以下にあるサンプルアプリをビルドするには、example ディレクトリで `make` を実行します。

    $ cd example
    $ make

これで各サンプルアプリが一斉にビルドされます。
rpn は逆ポーランド記法電卓、list は線形リストの実験、sdl はグラフィックライブラリ SDL2 を使ったデモです。
sdl をビルドするには libsdl2-dev パッケージがインストールされている必要があります。

    $ ./rpn
    2 3 +
    5

## opelac の使い方

`-target-arch <arch>` オプションで出力するアセンブラのアーキテクチャを指定できます。
デフォルトは `x86_64` です。

| arch    | 説明 |
|---------|------|
| x86_64  | x86-64 Linux の `as` 向けのアセンブリ言語コードを出力します |
| aarch64 | M1 Mac の `as` 向けのアセンブリ言語コードを出力します |

`-v` オプションで詳しい情報をコメントとして出力します。
（デフォルトでは型付け後の AST のみをコメント出力しますが、
このオプションを付けると型付け前の AST も出力します。）
